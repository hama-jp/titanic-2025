# v2.4実験: IsAlone削除の検証（微妙に悪化）

## 実験目的

ユーザーからの提案: **「IsAloneの削除も試そうか」**

検証内容: v2.2からIsAloneを削除し、FamilySizeだけで十分か確認

## 仮説

`IsAlone = (FamilySize == 1)`なので、FamilySizeがあればIsAloneは完全冗長

## 実験結果

### CVスコア比較

| バージョン | OOF Accuracy | OOF AUC | 特徴量数 | 変更点 |
|-----------|-------------|---------|---------|--------|
| **v2.2** | **84.29%** | **88.52%** | 17 | 基準 |
| v2.4 | 84.06% | 88.47% | 16 | IsAlone削除 |
| **差分** | **-0.23pt** | **-0.05pt** | -1 | |

### Fold別スコア

```
v2.4結果:
Fold 1: Accuracy=0.8715, AUC=0.9022
Fold 2: Accuracy=0.8764, AUC=0.8884
Fold 3: Accuracy=0.7921, AUC=0.8643
Fold 4: Accuracy=0.8371, AUC=0.8815
Fold 5: Accuracy=0.8258, AUC=0.9033

OOF Accuracy: 0.8406 (84.06%)
OOF AUC: 0.8847 (88.47%)
```

v2.2との差分:
```
Fold 1: 85.48% → 87.15% (+1.67pt) ✅
Fold 2: 87.08% → 87.64% (+0.56pt) ✅
Fold 3: 80.34% → 79.21% (-1.13pt) ❌
Fold 4: 83.71% → 83.71% (±0.00pt)
Fold 5: 84.83% → 82.58% (-2.25pt) ❌
```

### Feature Importance変化

**v2.2 (IsAlone含む):**
```
IsAlone           2.998 (最下位レベル)
FamilySize      267.337
```

**v2.4 (IsAloneなし):**
```
FamilySize      251.774 (若干減少)
```

## 分析

### △ 微妙に悪化（境界的な結果）

**1. 一見完全冗長に見えるが...**

- `IsAlone = (FamilySize == 1)` で数学的には完全冗長
- Feature Importanceも2.998と最低レベル
- しかし削除すると-0.23pt Accuracy悪化

**2. なぜ悪化するのか？**

木構造モデルにおけるバイナリフラグの利便性:

- **IsAloneがある場合**:
  ```
  if IsAlone == 1:  # 直接チェック可能
      高リスク
  ```

- **IsAloneがない場合**:
  ```
  if FamilySize == 1:  # 毎回計算必要
      高リスク
  ```

- 数学的には同じだが、木の学習効率が異なる
- バイナリフラグは分岐判定が簡単

**3. Fold間の不安定性**

- Fold 1, 2: 改善（+1.67pt, +0.56pt）
- Fold 3, 5: 悪化（-1.13pt, -2.25pt）
- 平均すると微妙に悪化
- データの分割方法に敏感

**4. 他の削除実験との比較**

| 削除特徴量 | Accuracy変化 | 理由 | 判定 |
|-----------|-------------|------|------|
| SibSp/Parch (v2.2) | +0.11pt | 完全冗長かつノイズ | ✅ 成功 |
| HasFamilyMatch (v2.1) | -0.79pt | 相互作用で重要 | ❌ 失敗 |
| Fare (v2.3) | -0.45pt | 補完的情報 | ❌ 失敗 |
| **IsAlone (v2.4)** | **-0.23pt** | **数学的冗長、モデル的有用** | **△ 微妙** |

## 数学的冗長性 vs モデル的冗長性

### ケース1: SibSp/Parch（削除成功）

```
FamilySize = SibSp + Parch + 1

- 数学的冗長: ✅（完全に線形関係）
- モデル的冗長: ✅（3つとも同じ情報）
- 結果: 削除成功（+0.11pt）
```

### ケース2: IsAlone（削除微妙）

```
IsAlone = (FamilySize == 1)

- 数学的冗長: ✅（完全に導出可能）
- モデル的冗長: ❌（バイナリフラグとして便利）
- 結果: 削除で微妙に悪化（-0.23pt）
```

### ケース3: Fare/FarePerPerson（削除失敗）

```
FarePerPerson = Fare / TicketGroupSize

- 数学的冗長: ❌（第三の変数が関与）
- モデル的冗長: ❌（異なる情報を提供）
- 結果: 削除失敗（-0.45pt）
```

## 重要な洞察

### 木構造モデルにおけるバイナリフラグの価値

**1. 分岐効率**
- `IsAlone == 1` は1回の比較で判定
- `FamilySize == 1` も1回だが、意味的に明確

**2. 解釈性**
- IsAloneは「一人旅」という明確な概念
- FamilySize==1より直感的

**3. Feature Importanceの限界**
- ImportanceはGainベースで測定
- バイナリフラグは他の特徴量と組み合わせて効果
- 単独では低くても、削除すると影響あり

### HasFamilyMatch削除失敗との類似性

**HasFamilyMatch削除（v2.1）:**
- Importance: 5.10（最下位）
- 削除結果: -0.79pt
- 理由: 相互作用で重要

**IsAlone削除（v2.4）:**
- Importance: 2.998（最下位）
- 削除結果: -0.23pt
- 理由: バイナリフラグとして便利

両方とも **「低Importance ≠ 不要」** を証明

## 結論

### △ IsAloneは保持すべき

**理由:**
1. 削除で-0.23pt悪化（小さいが確実）
2. 数学的には冗長だがモデル的には有用
3. バイナリフラグとして学習効率向上
4. 17特徴量から16特徴量への削減メリットが小さい

### 🎯 最終推奨

**v2.2（17特徴量）を最終版として維持**

削除成功したのは:
- ✅ SibSp, Parch（完全冗長 + ノイズ）

削除失敗・微妙なもの:
- ❌ HasFamilyMatch（-0.79pt）相互作用
- ❌ Fare（-0.45pt）補完的情報
- △ IsAlone（-0.23pt）モデル的有用性

### 学んだ教訓

**特徴量削除の3つのレベル**

1. **削除すべき（成功）**:
   - 完全冗長かつノイズ
   - 例: SibSp, Parch

2. **削除してはいけない（失敗）**:
   - 相互作用で重要: HasFamilyMatch
   - 補完的情報: Fare

3. **境界線（微妙）**:
   - 数学的冗長でもモデル的有用: IsAlone
   - 削除可能だが保持推奨

**Feature Importanceだけでは判断できない**
- 必ずCV実験で検証
- 数学的冗長性とモデル的冗長性は異なる
- 木構造モデルではバイナリフラグが有用

---

**最終結論**: v2.2（17特徴量）が最適バランス、これ以上の削減は不要

# v1 vs v2 比較分析

## v2の改善点

train+testを結合してグループサイズを計算する特徴量を追加：

1. **FamilyGroupSize** (NEW!)
   - Surname + FamilySizeでグループ化
   - train+testで計算して正確なグループサイズを取得
   - Feature Importance: 92.8 (12位)

2. **CabinGroupSize** (NEW!)
   - 同じCabinを共有している人数
   - train+testで計算
   - Feature Importance: 165.0 (9位) ← かなり効いている！

3. **HasFamilyMatch** (NEW!)
   - FamilyGroupSize > FamilySizeの場合に1
   - 同じ家族が複数見つかったかのフラグ
   - Feature Importance: 1.7 (18位) ← ほぼ効果なし

---

## スコア比較

| 指標 | v1 | v2 | 差分 |
|------|----|----|------|
| **OOF Accuracy** | **84.96%** | 84.18% | -0.78pt |
| **OOF AUC** | **88.41%** | 88.21% | -0.20pt |
| **特徴量数** | 16 | 19 | +3 |
| **予測死亡率** | 63.4% | 62.9% | -0.5pt |

---

## Fold別詳細

### v1

| Fold | Accuracy | AUC |
|------|----------|-----|
| 1 | 87.15% | 90.84% |
| 2 | 86.52% | 87.88% |
| 3 | 81.46% | 85.78% |
| 4 | 84.83% | 88.12% |
| 5 | 84.83% | 89.78% |

### v2

| Fold | Accuracy | AUC |
|------|----------|-----|
| 1 | 85.47% | 90.63% |
| 2 | 87.08% | 87.96% |
| 3 | 79.78% | 86.28% |
| 4 | 84.27% | 87.95% |
| 5 | 84.27% | 89.48% |

**観察:**
- Fold 3で差が大きい（v1: 81.46% vs v2: 79.78%）
- Fold 2ではv2の方が良い（v1: 86.52% vs v2: 87.08%）
- データ数が少ないので、Fold間の変動が大きい

---

## 予測の一致度

| 項目 | 値 |
|------|-----|
| 総サンプル数 | 418 |
| 予測が一致 | **412 (98.6%)** |
| 予測が異なる | **6 (1.4%)** |

**異なる予測のPassengerId:**
- 910, 924, 964, 1117, 1134, 1205

**結論:** v1とv2はほぼ同じ予測をしている。CVスコアの違いは誤差の範囲。

---

## Feature Importance比較（上位10）

### v1

| Rank | Feature | Importance |
|------|---------|-----------|
| 1 | Sex | 3154.3 |
| 2 | Age | 1111.4 |
| 3 | **FarePerPerson** | 1004.4 |
| 4 | Pclass | 940.8 |
| 5 | Fare | 828.0 |
| 6 | Title | 687.7 |
| 7 | TicketGroupSize | 381.9 |
| 8 | FamilySize | 291.0 |
| 9 | IsChild | 164.7 |
| 10 | Embarked | 131.0 |

### v2

| Rank | Feature | Importance |
|------|---------|-----------|
| 1 | Sex | 2945.8 |
| 2 | Pclass | 893.7 |
| 3 | Title | 868.8 |
| 4 | Age | 853.3 |
| 5 | FarePerPerson | 785.5 |
| 6 | Fare | 634.3 |
| 7 | TicketGroupSize | 353.1 |
| 8 | FamilySize | 246.9 |
| 9 | **CabinGroupSize** | 165.0 ← NEW! |
| 10 | IsChild | 133.0 |

**観察:**
- CabinGroupSize（NEW）が9位にランクイン
- FamilyGroupSize（NEW）は12位（92.8）
- 全体的にImportance値が下がっているのは、特徴量が増えて分散したため

---

## 分析と推奨

### v1の強み

- ✅ **CVスコアが若干高い**（84.96% vs 84.18%）
- ✅ **シンプル**（16特徴量）
- ✅ **安定性**が高い可能性

### v2の強み

- ✅ **CabinGroupSizeが効いている**（Importance 165.0）
- ✅ **train+testの情報を最大限活用**
- ✅ **本番データで効く可能性**（テスト分布が訓練と異なる場合）

### 推奨

**データ数が少ない（891行）ので、どちらも誤差の範囲内の可能性が高い。**

1. **保守的アプローチ**: v1を採用（CVスコアが高い）
2. **攻めのアプローチ**: v2を採用（train+testの情報活用）
3. **ハイブリッド**: CabinGroupSizeだけv1に追加（重要度が高いので）

**個人的推奨**: 両方を提出して、実際のLB（リーダーボード）スコアで判断するのが最も確実。

---

## 次のステップ

もしさらに改善するなら：

1. **FareBin** - Fareをビン化して非線形パターンを捕捉
2. **Sex×AgeBin交互作用** - 明示的な交互作用特徴
3. **Pclass×FarePerPerson交互作用** - クラス内での相対的な支払い能力
4. **アンサンブル** - LightGBM + XGBoost + CatBoost
5. **Optuna** - ハイパーパラメータ最適化（ただし過学習注意）

ただし、**データ数が少ないので、複雑化しすぎると逆効果**になる可能性が高い。
